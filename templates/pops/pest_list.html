{% extends 'base.html' %}
{% load static %}
{% load get_staff_approved %}
{% block page_styles %}
<link rel="stylesheet" href="{% static 'css/create_case_study_styles.css' %}">
{% endblock %}
{% block content %}

<style type="text/css" media="screen">
    .table-wrapper-scroll-y {
        display: block;
        max-height: 15em;
        overflow-y: auto;
        -ms-overflow-style: -ms-autohiding-scrollbar;
    }
</style>

<div class="container py-2 pb-4">
<div class="text-center">
    <h3>Available Pests and Pathogens</h3>
    </div>
<p>Below are the pests and pathogens that have been modeled using PoPS. Users may select a calibrated case study
to forecast the spread of a pest of pathogen using the PoPS web dashboard. </p>
{% if pests %}

{% for pest in pests %}
      <div class="card my-3 text-dark">
          <div class="card-header">
              <div class="row justify-content-between align-items-center">
                  <div class="col-md-auto col-sm-12">
                      <div class="row justify-content-xs-center justify-content-sm-center">
                          <div class="col-auto">
                              <img src="{% static 'images/SLF.png' %}" max-width="100%" alt="{{pest.common_name}}">
                          </div>
                          <div class="col-auto">
                              <h4 class="card-title"><a class="text-dark" href="{% url 'pest_detail' pk=pest.pk %}">{{ pest.common_name }}</a></h4>
                              <h6 class="card-subtitle mb-2">(<em>{{pest.scientific_name}}</em> <i class="fas fa-bug"></i> <i class="fas fa-virus"></i>)</h6>
                          </div>
                      </div>
                      </div>
                      <div class="col-md-auto col-sm-12">
                          <a href="{% url 'pest_detail' pk=pest.pk %}" class="btn btn-success btn-sm btn-block"> <i class="fas fa-plus-circle"
                                                                                data-toggle="tooltip"
                                                                                data-placement="top"
                                                                                title="Create session from this case study."></i> Run PoPS for {{pest.common_name}}</a>
                      </div>
                 
              </div>
            </div>
        <div class="card-body">
          
          <div class="row">
          <div class="col-lg-6">
                    <ul class="nav nav-tabs" id="{{pest.pk}}-list" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" href="#about-{{pest.pk}}" role="tab" aria-controls="about" aria-selected="true">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link"  href="#management-{{pest.pk}}" role="tab" aria-controls="management" aria-selected="false">Management</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#at_risk-{{pest.pk}}" role="tab" aria-controls="risk" aria-selected="false">What's at risk?</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#case_studies-{{pest.pk}}" role="tab" aria-controls="case studies" aria-selected="false">Case studies</a>
            </li>

          </ul>
                     <div class="tab-content mt-3">
            <div class="tab-pane active" id="about-{{pest.pk}}" role="tabpanel">
            <p class="card-text">{{ pest.about|truncatechars:420 }}... <a href="{% url 'pest_detail' pk=pest.pk %}" class="card-link text-danger">Read more</a></p>
                          </div>
             
            <div class="tab-pane" id="management-{{pest.pk}}" role="tabpanel" aria-labelledby="management-tab">  
              <p class="card-text"><strong>Management activities: </strong>{{ pest.management_activity|truncatechars:370  }}... <a href="{% url 'pest_detail' pk=pest.pk %}" class="card-link text-danger">Read more</a></p>
              
            </div>
             
            <div class="tab-pane" id="at_risk-{{pest.pk}}" role="tabpanel" aria-labelledby="risk-tab">
              <p class="card-text"><strong>{{  pest.common_name }} commonly affects: </strong></p> 
              <p> {{ pest.risks }}</p>
            </div>
            <div class="tab-pane" id="case_studies-{{pest.pk}}" role="tabpanel" aria-labelledby="case_studies-tab">
              <strong>Pick a calibrated case study to run PoPS for {{ pest.common_name}}.</strong>
              {% with case_study_pests=pest.pest_set.all %}
                                {% for case_study_pest in case_study_pests %} 
                                {% if case_study_pest.case_study.staff_approved == True %}
                                <div>
                                <a href="{% url 'case_study_review' pk=case_study_pest.case_study.pk %}""><strong>{{ case_study_pest.case_study.name }} <i class="fas fa-play-circle"></i></strong></a>
                                <div><small>{{ case_study_pest.case_study.description }}</small></div>
                                
                                </div>
                                {% endif %}
                                    {% endfor %} 
                                    {% endwith %}
            </div>
          </div>
          </div>
          <div class="col-lg-6" >
          <div class="text-center py-0 my-0" >
          <p class="py-0 my-0" ><strong>PoPS forecast of {{pest.common_name}}:</strong></p>
            <img src="{% static 'images/SLF-spread-356x200px.gif' %}" max-width="100%" alt="{{pest.common_name}} forecast spread over time">
            </div>
          </div>
          </div>
        </div>
      </div>
      <script>
      $('#{{pest.pk}}-list a').on('click', function (e) {
        e.preventDefault()
        $(this).tab('show')
        })
      </script>
      {% endfor %}

{% else %}
There are no staff-approved pests or pathogens at this time. Please contact an admin to report the problem.
{% endif %}

<p>
To view a list of all case studies, click <a href="{% url 'case_study_list' %}">here</a>. 
Or <a href="{% url 'create_case_study' %}">create your own case study</a> (advanced users).
</p>

    {% endblock %}

    {% block scripts %}
<script>
  $(document).ready(function () {
    $("body").tooltip({
      selector: '[data-toggle=tooltip]'
    });
  });
  </script>
{% endblock %}