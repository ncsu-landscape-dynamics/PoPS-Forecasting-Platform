{% extends 'base.html' %}
{% load static %}
{% load get_staff_approved %}
{% block page_styles %}
<link rel="stylesheet" href="{% static 'css/create_case_study_styles.css' %}">
{% endblock %}
{% block content %}

<style type="text/css" media="screen">
    .table-wrapper-scroll-y {
        display: block;
        max-height: 30em;
        overflow-y: auto;
        -ms-overflow-style: -ms-autohiding-scrollbar;
    }
</style>

<div class="container py-2 pb-4">
    <div class="row">
        <div class="col-8">
            <h4>Share session "<strong>{{ session.name }}</strong>" with other PoPS users:</h4>
            <div>What does sharing mean?</div>
            <div>
                <strong>Share settings:</strong>
            </div>
<div class="custom-control custom-radio custom-control-inline">
  <input type="radio" id="customRadioInline1" name="customRadioInline1" class="custom-control-input" checked>
  <label class="custom-control-label" for="customRadioInline1">Private</label>
</div>
<div class="custom-control custom-radio custom-control-inline">
  <input type="radio" id="customRadioInline2" name="customRadioInline1" class="custom-control-input">
  <label class="custom-control-label" for="customRadioInline2">Public (not recommended)</label>
</div>


            <div id="public_help">
                <p>Are you sure you want to make this session public? This will allow any PoPS
                    user with your session ID to make changes to your session. We recommend public sessions for
                    for educational purposes, however we do NOT recommend using a public
                    session if you care about your data and results.</p>
                    <p> You can select specific PoPS users to share your session with.</p>
            </div>
<div id="sharing"> 
<div>
<strong>Share this session with specific PoPS users:</strong>

<form id="add-allowed-users" method="post">{% csrf_token %}
<input type="hidden" id="id_session" name="session" value="{{ session.pk }}">
{% for user in users %}
<div>
<button form="add-allowed-users" class="btn btn-sm btn-info" type="submit" name="user" id="id_user" value="{{ user.pk }}">+</button>
{{ user.username }} ({{ user.first_name }} {{ user.last_name }} - {{ user.pk }})
</div>
{% endfor %}
</form>
<div>
Currently shared with:
{% for allowed_user in allowed_users %}
<div>
<a class="btn btn-danger btn-sm" 
href="{% url 'delete_allowed_user' pk=allowed_user.pk %}" 
role="button">remove</a>
{{ allowed_user.user.username }} ({{ allowed_user.user.first_name }} {{ allowed_user.user.last_name }} - {{ allowed_user.user.pk }})
</div>
{% endfor %}
</div>
</div>
<form id="search-users">
{% csrf_token %}
      <input type="text" placeholder="Search.." name="search">
      <button form="search-users" type="submit"><i class="fa fa-search"></i></button>
    </form>
</div>
        <div id="sharing_help">
            <p>Sharing will allow other users to:</p>
            <ul>
                <li>View your dashboard session</li>
                <li>Edit your dashboard session</li>
                <li>Create new runs in your session</li>
                <li>Delete runs in your session</li>
            </ul>
            <p>Sharing will NOT allow other users to:</p>
            <ul>
                <li>Delete your session</li>
                <li>View your workspace</li>
                <li>View sessions other than this one</li>
            </ul>
        </div>

    <div class="row pb-4">
        <div class="col-auto">
            <div class="d-inline text-center p-2">
                <a class="btn btn-secondary btn" href="{% url 'dashboard' pk=session.pk %}" role="button">Save and return to
                    dashboard</a>
            </div>
        </div>
    </div>
    

    <p>They say sharing is caring. </p>
</div>
</div>
</div>
<script>
    $("#search-users").on('click', function () {
      event.preventDefault();
      console.log("search form submitted!") // sanity check
      var form = $(this).closest("form");
      $.ajax({
        url: "{% url 'user_list' %}",
        data: form.serialize(),
        type : "GET", // http method
        success: function (data) {
          alert('It worked');
          console.log(data.pk)
        },
                // handle a non-successful response
        error : function(xhr,errmsg,err) {
            $('#results').html("<div class='alert-box alert radius' data-alert>Oops! We have encountered an error: "+errmsg+
                " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
            console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
        }
      });
</script>
    {% endblock %}